# Comboi Transformations Configuration
#
# This file defines transformations using DuckDB SQL, generated from data contracts.
# All transformations are declarative and driven by the contract definitions.
#
# Transformation Structure:
#   type: sql  - DuckDB SQL scripts generated from contracts
#
# Quality Checks:
#   - contract:contract_name  - References transformations/contracts/contract_name.yml
#
# =============================================================================
# SAMPLE TRANSFORMATION EXAMPLE
# =============================================================================
# This is a sample showing how to configure a SQL transformation with a data contract.
# The SQL transformation is automatically generated from the contract schema.
# To use this:
# 1. Create your data contract in transformations/contracts/
# 2. Generate SQL transformation from the contract using: python build.py --generate-sql
# 3. Configure below referencing the contract

silver:
  # Sample GDPR-compliant customer data transformation with contract-driven SQL
  - name: gdpr_customers
    type: sql
    inputs:
      - alias: bronze_customers
        stage: bronze
        source_path: "crm/customers.parquet"
    quality_checks:
      - contract:gdpr_customers

# Add your own transformations here following the same pattern
# The SQL transformation will be generated from the contract definition

  # =============================================================================
  # SAP BUSINESS ONE - GDPR-COMPLIANT TRANSFORMATIONS
  # =============================================================================

  # SAP B1 Master Data (GDPR-sensitive tables with pseudonymization)
  - name: sap_ocrd_silver
    type: sql
    inputs:
      - alias: bronze_ocrd
        stage: bronze
        source_path: "sap_b1_services/OCRD.parquet"
    quality_checks:
      - contract:sap_ocrd_silver

  - name: sap_oprj_silver
    type: sql
    inputs:
      - alias: bronze_oprj
        stage: bronze
        source_path: "sap_b1_services/OPRJ.parquet"
    quality_checks:
      - contract:sap_oprj_silver

  - name: sap_oslp_silver
    type: sql
    inputs:
      - alias: bronze_oslp
        stage: bronze
        source_path: "sap_b1_services/OSLP.parquet"
    quality_checks:
      - contract:sap_oslp_silver

  # SAP B1 Transaction Tables (pass-through, already GDPR-compliant)
  - name: silver_oinv
    type: sql
    inputs:
      - alias: bronze_oinv
        stage: bronze
        source_path: "sap_b1_services/OINV.parquet"

  - name: silver_inv1
    type: sql
    inputs:
      - alias: bronze_inv1
        stage: bronze
        source_path: "sap_b1_services/INV1.parquet"

  - name: silver_pch1
    type: sql
    inputs:
      - alias: bronze_pch1
        stage: bronze
        source_path: "sap_b1_services/PCH1.parquet"

gold:
  # =============================================================================
  # SAP BUSINESS ONE - KPI METRICS
  # =============================================================================

  # Revenue metrics with GDPR-compliant customer/project attribution
  - name: sap_revenue_metrics_gold
    type: sql
    inputs:
      - alias: silver_oinv
        stage: silver
        source_path: "refined/silver_oinv.parquet"
      - alias: silver_inv1
        stage: silver
        source_path: "refined/silver_inv1.parquet"
      - alias: silver_ocrd
        stage: silver
        source_path: "refined/sap_ocrd_silver.parquet"
      - alias: silver_oprj
        stage: silver
        source_path: "refined/sap_oprj_silver.parquet"
    quality_checks:
      - contract:sap_revenue_metrics_gold

  # 360-degree customer analytics
  - name: sap_customer_analytics_gold
    type: sql
    inputs:
      - alias: silver_ocrd
        stage: silver
        source_path: "refined/sap_ocrd_silver.parquet"
      - alias: silver_oinv
        stage: silver
        source_path: "refined/silver_oinv.parquet"
    quality_checks:
      - contract:sap_customer_analytics_gold

  # Project profitability analysis
  - name: sap_project_profitability_gold
    type: sql
    inputs:
      - alias: silver_oprj
        stage: silver
        source_path: "refined/sap_oprj_silver.parquet"
      - alias: silver_inv1
        stage: silver
        source_path: "refined/silver_inv1.parquet"
      - alias: silver_pch1
        stage: silver
        source_path: "refined/silver_pch1.parquet"
    quality_checks:
      - contract:sap_project_profitability_gold
