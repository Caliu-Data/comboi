version: "1.0.0"
dataset: "finance_transactions_verified"
stage: "silver"
owner: "finance-data-team"
description: "Verified and cleansed financial transactions with fraud checks"

schema:
  columns:
    - name: transaction_id
      type: VARCHAR
      nullable: false
      description: "Unique transaction identifier"
      constraints:
        - unique: true
        - not_null: true
    - name: account_id
      type: VARCHAR
      nullable: false
      description: "Account identifier"
      constraints:
        - not_null: true
    - name: transaction_date
      type: TIMESTAMP
      nullable: false
      description: "Transaction timestamp"
      constraints:
        - not_null: true
    - name: amount
      type: DECIMAL
      nullable: false
      description: "Transaction amount (positive for credit, negative for debit)"
      constraints:
        - not_null: true
    - name: currency
      type: VARCHAR
      nullable: false
      description: "Currency code (ISO 4217)"
      constraints:
        - not_null: true
        - pattern: "^[A-Z]{3}$"
    - name: transaction_type
      type: VARCHAR
      nullable: false
      description: "Type of transaction"
      constraints:
        - allowed_values: ["deposit", "withdrawal", "transfer", "payment", "refund"]
    - name: status
      type: VARCHAR
      nullable: false
      description: "Transaction status"
      constraints:
        - allowed_values: ["pending", "completed", "failed", "cancelled"]
    - name: fraud_score
      type: DECIMAL
      nullable: true
      description: "Fraud detection score (0-1, higher = more suspicious)"
      constraints:
        - min_value: 0
        - max_value: 1

quality_rules:
  - name: "no_duplicate_transactions"
    type: "uniqueness"
    column: "transaction_id"
    severity: "error"
  - name: "no_null_transaction_ids"
    type: "not_null"
    column: "transaction_id"
    severity: "error"
  - name: "no_null_amounts"
    type: "not_null"
    column: "amount"
    severity: "error"
  - name: "valid_currency_format"
    type: "custom_sql"
    query: "SELECT COUNT(*) FROM {dataset} WHERE LENGTH(currency) != 3 OR currency != UPPER(currency)"
    expected: 0
    severity: "error"
  - name: "reasonable_transaction_amounts"
    type: "custom_sql"
    query: "SELECT COUNT(*) FROM {dataset} WHERE ABS(amount) > 1000000"
    expected: 0
    severity: "warning"
  - name: "minimum_transactions"
    type: "volume"
    min_rows: 1
    severity: "error"

sla:
  freshness:
    max_age_hours: 2
    schedule: "hourly"
  completeness:
    min_row_count: 100

evolution:
  backward_compatible: true
  breaking_changes_allowed: false
  deprecation_notice_days: 30
